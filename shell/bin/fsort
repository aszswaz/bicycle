#!/bin/sh

# 对指定文件夹下的文件进行排序

# 打印帮助信息
function usage() {
    echo "Usage: fsort [options...]"
    echo "Description: This software is used to carry out orderly renaming to the document under the appointed catalogue"
    local format="%4s    %-40s\n"
    printf "$format" "-h" 'Print help information'
    printf "$format" "-s" 'source directory, default is $PWD'
    exit 0
}

# 源文件夹
source_dir="$PWD"

if [[ $# > 0 ]]; then
    while getopts ":h:s:" opt; do
        case $opt in
            s)
                source_dir="$(realpath "${OPTARG}")"
                ;;
            h | *)
                usage
                ;;
        esac
    done
fi

# 数位，用 N 个数字作为文件名称
digit=0
# 序号
number=1
# 源文件列表
source_files=()

for file in $source_dir/*; do
    if [[ -d $file ]]; then
        continue
    fi
    source_files[$(( ${#source_files[*]} + 1 ))]="$file"
    filename=$(basename "$file")
    filename=${filename%.*}
done

file_count=${#source_files[*]}
if [[ $file_count == 0 ]]; then
    exit 0
fi
# 根据目录下的文件数量，确定要用多少位数作为文件名称
if [[ ${#file_count} < 2 ]]; then
    digit=2
else
    digit=${#file_count}
fi

index=1
for file in ${source_files[*]}; do
    filename=$(basename "$file")
    suffix=${filename##*.}
    [[ $suffix != "" ]] && suffix=".$suffix"

    while true; do
        new_file="$source_dir/$(printf "%0${digit}d" $index)${suffix}"
        if [[ ! -e $new_file ]]; then
            mv -v "$file" "${new_file}"
            ((index++))
            break
        fi
        ((index++))
    done
done
